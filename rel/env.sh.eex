#!/bin/sh

# Fly.io sets FLY_APP_NAME and FLY_PRIVATE_IP
# We use these to set up Erlang distribution

export RELEASE_DISTRIBUTION=name
export RELEASE_NODE="${FLY_APP_NAME}@${FLY_PRIVATE_IP}"

# Use IPv6 for distribution (Fly's private network is IPv6)
export ERL_AFLAGS="-proto_dist inet6_tcp"

# Generate a cookie if not set
if [ -z "$RELEASE_COOKIE" ]; then
  export RELEASE_COOKIE=$(cat /app/releases/COOKIE 2>/dev/null || echo "vfs-spike-cookie")
fi
